name: Reusable Datadog Service Definition
on: 
  workflow_call:
    inputs:
      serviceName:
        required: false
        type: string
        default: "service"
      emailName:
        required: false
        type: string
        default: "e-mail"
      squadName:
        required: false
        type: string
        default: "squad"
      slackChannelName:
        required: false
        type: string
        default: "slack"
      tagName1:
        required: false
        type: string
        default: "key:value"
      tagName2:
        required: false
        type: string
        default: "key:value"
      reposName:
        required: false
        type: string
        default: "repository.name"
      # reposURL:
      #   required: false
      #   type: string
      #   default: "repository.url"
      # reposProvider:
      #   required: false
      #   type: string
      #   default: "repository.provider"
      # reposMatrix:
      #   required: false
      #   type: string
      # contactName:
      #   required: false
      #   type: string
      #   default: "contact.name"
      # contactType:
      #   required: false
      #   type: string
      #   default: "contact.type"
      # contactValue:
      #   required: false
      #   type: string
      #   default: "contact.value"
      # docName:
      #   required: false
      #   type: string
      #   default: "doc.name"
      docUrl:
        required: false
        type: string
        default: "doc.url"
      # docProvider:
      #   required: false
      #   type: string
      #   default: "doc.provider"
      # linkName:
      #   required: false
      #   type: string
      #   default: "link.name"
      linkUrl:
        required: false
        type: string
        default: "link.url"
      # linkType:
      #   required: false
      #   type: string
      #   default: "link.type"
jobs:
  datadog-service-deinition:
    runs-on: ubuntu-latest
    steps:
      - name: Get Code
        uses: actions/checkout@v3
        # with:
        #   repository: bruno561/opentelemetry-demo
        #   ref: 'dev'
      - name: Service Definition
        uses: arcxp/datadog-service-catalog-metadata-provider@v1.0.4
        with:
          datadog-hostname: api.us5.datadoghq.com
          datadog-key: ${{ secrets.DATADOG_API_KEY }}
          datadog-app-key: ${{ secrets.DATADOG_APPLICATION_KEY }}
          service-name: ${{ inputs.serviceName }}
          team: ${{ inputs.squadName }}
          email: ${{ inputs.emailName }}
          slack-support-channel: ${{ inputs.slackChannelName }}
          # contacts: |
          #   - name: ${{ inputs.contactName }}
          #     type: ${{ inputs.contactType }}
          #     value: ${{ inputs.contactValue }}
          docs: |
            - name: Documentation
              url: ${{ inputs.docUrl }}
              provider: Confluence
          links: |
            - name: Grafana
              url: ${{ inputs.linkUrl }}
              type: Dashboard
          repos: |
            - name: ${{ github.event.repository.name }}
              url: ${{ 'github.server_url/github.repository' }}
              provider: GitHub
          tags: |
              - ${{ inputs.tagName1 }}
              - ${{ inputs.tagName2 }}
